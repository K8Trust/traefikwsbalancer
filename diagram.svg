<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
    <!-- Title -->
    <text x="400" y="30" font-family="Arial" font-size="20" text-anchor="middle" font-weight="bold">Traefik WebSocket Connection Balancer</text>
    
    <!-- Client -->
    <rect x="50" y="80" width="120" height="80" fill="#ffeeee" stroke="#000000" stroke-width="2" />
    <text x="110" y="110" font-family="Arial" font-size="14" text-anchor="middle" font-weight="bold">Client</text>
    <text x="110" y="130" font-family="Arial" font-size="12" text-anchor="middle">WebSocket Client</text>
    <text x="110" y="150" font-family="Arial" font-size="12" text-anchor="middle">Browser/App</text>
    
    <!-- Traefik -->
    <rect x="300" y="60" width="250" height="120" fill="#eeffee" stroke="#000000" stroke-width="2" />
    <text x="425" y="80" font-family="Arial" font-size="14" text-anchor="middle" font-weight="bold">Traefik Proxy</text>
    
    <!-- Balancer Middleware -->
    <rect x="320" y="95" width="210" height="70" fill="#eeeeff" stroke="#000000" stroke-width="2" />
    <text x="425" y="115" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">WebSocket Connection Balancer</text>
    <text x="425" y="135" font-family="Arial" font-size="10" text-anchor="middle">Middleware Plugin</text>
    <text x="425" y="155" font-family="Arial" font-size="10" text-anchor="middle">Routes to service with lowest connections</text>
    
    <!-- Metrics -->
    <rect x="650" y="80" width="120" height="80" fill="#fff8ee" stroke="#000000" stroke-width="2" />
    <text x="710" y="110" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">Metrics Endpoint</text>
    <text x="710" y="130" font-family="Arial" font-size="10" text-anchor="middle">/balancer-metrics</text>
    
    <!-- Arrows for connection flow -->
    <line x1="170" y1="120" x2="300" y2="120" stroke="#666666" stroke-width="2" />
    <polygon points="295,115 300,120 295,125" fill="#666666" />
    <text x="235" y="110" font-family="Arial" font-size="10" text-anchor="middle">WebSocket</text>
    <text x="235" y="125" font-family="Arial" font-size="10" text-anchor="middle">Connection</text>
    
    <line x1="550" y1="120" x2="650" y2="120" stroke="#666666" stroke-width="2" />
    <polygon points="645,115 650,120 645,125" fill="#666666" />
    <text x="600" y="110" font-family="Arial" font-size="10" text-anchor="middle">JSON</text>
    <text x="600" y="125" font-family="Arial" font-size="10" text-anchor="middle">Metrics</text>
    
    <line x1="425" y1="180" x2="425" y2="230" stroke="#666666" stroke-width="2" />
    <polygon points="420,225 425,230 430,225" fill="#666666" />
    
    <!-- Backend Services -->
    <rect x="110" y="230" width="160" height="120" fill="#eeeeff" stroke="#000000" stroke-width="2" />
    <text x="190" y="250" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">Backend Service 1</text>
    
    <!-- Pods in Service 1 -->
    <rect x="130" y="270" width="50" height="50" fill="#ffffff" stroke="#000000" stroke-width="1" />
    <text x="155" y="295" font-family="Arial" font-size="10" text-anchor="middle">Pod 1</text>
    
    <rect x="190" y="270" width="50" height="50" fill="#ffffff" stroke="#000000" stroke-width="1" />
    <text x="215" y="295" font-family="Arial" font-size="10" text-anchor="middle">Pod 2</text>
    
    <!-- Selected Service -->
    <rect x="320" y="230" width="210" height="120" fill="#eeeeff" stroke="#000000" stroke-width="2" stroke-dasharray="5,5" />
    <text x="425" y="250" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">Backend Service 2</text>
    <text x="425" y="270" font-family="Arial" font-size="10" text-anchor="middle" fill="#990000">Selected Service (Lowest Connections)</text>
    
    <!-- Pods in Service 2 -->
    <rect x="340" y="290" width="50" height="50" fill="#ffffff" stroke="#000000" stroke-width="1" />
    <text x="365" y="315" font-family="Arial" font-size="10" text-anchor="middle">Pod 1</text>
    
    <rect x="400" y="290" width="50" height="50" fill="#ffffff" stroke="#000000" stroke-width="1" />
    <text x="425" y="315" font-family="Arial" font-size="10" text-anchor="middle">Pod 2</text>
    
    <rect x="460" y="290" width="50" height="50" fill="#ffffff" stroke="#000000" stroke-width="1" />
    <text x="485" y="315" font-family="Arial" font-size="10" text-anchor="middle">Pod 3</text>
    
    <!-- Service 3 -->
    <rect x="580" y="230" width="160" height="120" fill="#eeeeff" stroke="#000000" stroke-width="2" />
    <text x="660" y="250" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">Backend Service 3</text>
    
    <!-- Pods in Service 3 -->
    <rect x="600" y="270" width="50" height="50" fill="#ffffff" stroke="#000000" stroke-width="1" />
    <text x="625" y="295" font-family="Arial" font-size="10" text-anchor="middle">Pod 1</text>
    
    <rect x="660" y="270" width="50" height="50" fill="#ffffff" stroke="#000000" stroke-width="1" />
    <text x="685" y="295" font-family="Arial" font-size="10" text-anchor="middle">Pod 2</text>
    
    <!-- Metrics Collection -->
    <line x1="190" y1="350" x2="190" y2="400" stroke="#666666" stroke-width="1" />
    <line x1="425" y1="350" x2="425" y2="400" stroke="#666666" stroke-width="1" />
    <line x1="660" y1="350" x2="660" y2="400" stroke="#666666" stroke-width="1" />
    
    <line x1="190" y1="400" x2="660" y2="400" stroke="#666666" stroke-width="1" />
    <line x1="425" y1="400" x2="425" y2="430" stroke="#666666" stroke-width="2" />
    <polygon points="420,425 425,430 430,425" fill="#666666" />
    
    <!-- Connection Collection -->
    <rect x="250" y="430" width="350" height="80" fill="#fff0f0" stroke="#000000" stroke-width="2" />
    <text x="425" y="450" font-family="Arial" font-size="14" text-anchor="middle" font-weight="bold">Connection Count Collection</text>
    <text x="425" y="470" font-family="Arial" font-size="10" text-anchor="middle">1. Direct Service Metrics (/metric)</text>
    <text x="425" y="490" font-family="Arial" font-size="10" text-anchor="middle">2. Pod Discovery via IP Scanning</text>
    <text x="425" y="505" font-family="Arial" font-size="10" text-anchor="middle">3. Connection Count Caching</text>
    
    <!-- Pod Discovery -->
    <line x1="600" y1="470" x2="650" y2="470" stroke="#666666" stroke-width="1" />
    <polygon points="645,465 650,470 645,475" fill="#666666" />
    
    <rect x="650" y="430" width="130" height="120" fill="#f0fff0" stroke="#000000" stroke-width="2" />
    <text x="715" y="450" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">Pod Discovery</text>
    <text x="715" y="470" font-family="Arial" font-size="10" text-anchor="middle">Methods:</text>
    <text x="715" y="485" font-family="Arial" font-size="10" text-anchor="middle">1. Endpoints API</text>
    <text x="715" y="500" font-family="Arial" font-size="10" text-anchor="middle">2. Direct DNS</text>
    <text x="715" y="515" font-family="Arial" font-size="10" text-anchor="middle">3. IP Scanning</text>
    <text x="715" y="530" font-family="Arial" font-size="10" text-anchor="middle">(Â±5 3rd octet)</text>
    
    <!-- IP Scanning explanation -->
    <text x="400" y="550" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">IP Scanning finds pods across different subnets</text>
    <text x="400" y="570" font-family="Arial" font-size="10" text-anchor="middle">Example: Discovers 100.68.32.4 and 100.68.36.4 by varying the third octet</text>
</svg> 